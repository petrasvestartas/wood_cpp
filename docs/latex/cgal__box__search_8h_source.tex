\doxysection{cgal\+\_\+box\+\_\+search.\+h}
\hypertarget{cgal__box__search_8h_source}{}\label{cgal__box__search_8h_source}\index{C:/brg/2\_code/wood\_cpp/backend/src/wood/include/cgal\_box\_search.h@{C:/brg/2\_code/wood\_cpp/backend/src/wood/include/cgal\_box\_search.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ \#include\ "{}../../stdafx.h"{}}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{//\ ToDo}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ What\ happens\ when\ 3\ beams\ meet\ in\ one\ node\ when\ only\ two\ joints\ are\ needed,\ maybe\ move\ ends\ apart\ from\ each\ other\ or\ give\ point\ id}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Check\ edge\ normals}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }cgal\_box\_search}
\DoxyCodeLine{00009\ \{}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ value\_at(IK::Plane\_3\ \&Pl,\ IK::Point\_3\ \&P)}
\DoxyCodeLine{00011\ \ \ \ \ \{}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (Pl.a()\ *\ P.hx()\ +\ Pl.b()\ *\ P.hy()\ +\ Pl.c()\ *\ P.hz()\ +\ Pl.d());}
\DoxyCodeLine{00013\ \ \ \ \ \}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ line\_plane(}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ IK::Segment\_3\ \&L,}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ IK::Plane\_3\ \&Pl,}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ IK::Point\_3\ \&P}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ double*\ line\_parameter}}
\DoxyCodeLine{00021\ \ \ \ \ )}
\DoxyCodeLine{00022\ \ \ \ \ \{}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ rc\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ a,\ b,\ d,\ fd,\ t;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pt0\ =\ L[0];}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pt1\ =\ L[1];}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ a\ =\ value\_at(Pl,\ pt0);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ b\ =\ value\_at(Pl,\ pt1);}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ d\ =\ a\ -\/\ b;}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ ==\ 0.0)}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fabs(a)\ <\ fabs(b))}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 0.0;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (fabs(b)\ <\ fabs(a))}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 1.0;}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 0.5;}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ d\ =\ 1.0\ /\ d;}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ fd\ =\ fabs(d);}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fd\ >\ 1.0\ \&\&\ (fabs(a)\ >=\ ON\_DBL\_MAX\ /\ fd\ ||\ fabs(b)\ >=\ ON\_DBL\_MAX\ /\ fd))}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ double\ overflow\ -\/\ line\ may\ be\ (nearly)\ parallel\ to\ plane}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 0.5;}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ a\ /\ (a\ -\/\ b);\ \textcolor{comment}{//\ =\ a*d;\ \ a/(a-\/b)\ has\ more\ precision\ than\ a*d}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rc\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (line\_parameter)}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ *line\_parameter\ =\ t;}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ s[0].z()}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ 26\ Feb\ 2003\ Dale\ Lear}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ Changed}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ return\ (1-\/t)*from\ +\ t*to;}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ to\ the\ following\ so\ that\ axis\ aligned\ lines\ will}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ return\ exact\ answers\ for\ large\ values\ of\ t.}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ See\ RR\ 9683.}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ s\ =\ 1.0\ -\/\ t;}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ P\ =\ IK::Point\_3(}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ (L[0].x()\ ==\ L[1].x())\ ?\ L[0].x()\ :\ s\ *\ L[0].x()\ +\ t\ *\ L[1].x(),}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ (L[0].y()\ ==\ L[1].y())\ ?\ L[0].y()\ :\ s\ *\ L[0].y()\ +\ t\ *\ L[1].y(),}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ (L[0].z()\ ==\ L[1].z())\ ?\ L[0].z()\ :\ s\ *\ L[0].z()\ +\ t\ *\ L[1].z());}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (finite\ \&\&\ (t\ <\ 0\ ||\ t>1))}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ return\ false;}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rc;}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ remap(\textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&value,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&from1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&to1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&from2,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ \&to2)}
\DoxyCodeLine{00081\ \ \ \ \ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (value\ -\/\ from1)\ /\ (to1\ -\/\ from1)\ *\ (to2\ -\/\ from2)\ +\ from2;}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{double}\ length(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{double}\ z)}
\DoxyCodeLine{00086\ \ \ \ \ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ double\ ON\_DBL\_MIN\ =\ 2.22507385850720200e-\/308;}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ len;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ x\ =\ fabs(x);}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ y\ =\ fabs(y);}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ z\ =\ fabs(z);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (y\ >=\ x\ \&\&\ y\ >=\ z)}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ x;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ y;}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ y\ =\ len;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (z\ >=\ x\ \&\&\ z\ >=\ y)}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ x;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ x\ =\ z;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ z\ =\ len;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 15\ September\ 2003\ Dale\ Lear}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ For\ small\ denormalized\ doubles\ (positive\ but\ smaller}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ than\ DBL\_MIN),\ some\ compilers/FPUs\ set\ 1.0/x\ to\ +INF.}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ Without\ the\ ON\_DBL\_MIN\ test\ we\ end\ up\ with}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ microscopic\ vectors\ that\ have\ infinte\ length!}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ This\ code\ is\ absolutely\ necessary.\ \ It\ is\ a\ critical}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ part\ of\ the\ bug\ fix\ for\ RR\ 11217.}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ >\ ON\_DBL\_MIN)}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ y\ /=\ x;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ z\ /=\ x;}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ x\ *\ sqrt(1.0\ +\ y\ *\ y\ +\ z\ *\ z);}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (x\ >\ 0.0\ \&\&\ ON\_IS\_FINITE(x))}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ x;}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ len\ =\ 0.0;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ len;}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ unitize(IK::Vector\_3\ \&v)}
\DoxyCodeLine{00129\ \ \ \ \ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ rc\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Since\ x,y,z\ are\ floats,\ d\ will\ not\ be\ renormalized\ and\ the}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ON\_DBL\_MIN\ tests\ in\ ON\_2dVector::Unitize()\ are\ not\ needed.}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ d\ =\ length(v.x(),\ v.y(),\ v.z());}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ >\ 0.0)}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dx\ =\ v.x();}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dy\ =\ v.y();}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dz\ =\ v.z();}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ v\ =\ IK::Vector\_3(}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (dx\ /\ d),}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (dy\ /\ d),}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (dz\ /\ d));}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ rc\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rc;}
\DoxyCodeLine{00147\ \ \ \ \ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ two\_rect\_from\_point\_vector\_and\_zaxis(}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ IK::Point\_3\ \&p,\ IK::Vector\_3\ \&segment\_vector,\ IK::Vector\_3\ \&zaxis,\ \textcolor{keywordtype}{bool}\ middle,\ \textcolor{keywordtype}{double}\ radius,\ \textcolor{keywordtype}{double}\ length,\ \textcolor{keywordtype}{int}\ flip\_male,}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ CGAL\_Polyline\ \&rect0,\ CGAL\_Polyline\ \&rect1)}
\DoxyCodeLine{00152\ \ \ \ \ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ IK::Vector\_3\ x\_axis\ =\ zaxis;}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ IK::Vector\_3\ y\_axis\ =\ CGAL::cross\_product(zaxis,\ segment\_vector);\ \textcolor{comment}{//\ CGAL::cross\_product(x\_axis,\ zaxis);}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ x\_axis\ =\ CGAL::cross\_product(y\_axis,\ segment\_vector);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL::cross\_product(x\_axis,\ zaxis);}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ unitize(x\_axis);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ unitize(y\_axis);}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ x\_axis\ *=\ radius;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ y\_axis\ *=\ radius;}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IK::Vector\_3\ segment\_vector0\ =\ middle\ ?\ segment\_vector\ *\ length\ *\ -\/0.5\ :\ segment\_vector\ *\ length\ *\ 0.0;}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IK::Vector\_3\ segment\_vector1\ =\ middle\ ?\ segment\_vector\ *\ length\ *\ 0.5\ :\ segment\_vector\ *\ length\ *\ 1.0;}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ IK::Vector\_3\ segment\_vector0\ =\ segment\_vector\ *\ length\ *\ -\/0.5;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ IK::Vector\_3\ segment\_vector1\ =\ segment\_vector\ *\ length\ *\ 0.5;}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ std::array<IK::Vector\_3,\ 4>\ v\ =\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ -\/x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ -\/x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!middle)}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flip\_male\ ==\ 1)}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ simple\ rotation\ to\ the\ left}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::rotate(v.begin(),\ v.begin()\ +\ 1,\ v.end());}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (flip\_male\ ==\ -\/1)}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ simple\ rotation\ to\ the\ right}}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::rotate(v.rbegin(),\ v.rbegin()\ +\ 1,\ v.rend());}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ draw\ two\ rectangles}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ rect0\ =\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[1],}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector1\ +\ v[1],}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector1\ +\ v[0],}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[0],}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[1],}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ rect1\ =\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[2],}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector1\ +\ v[2],}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector1\ +\ v[3],}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[3],}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ p\ +\ segment\_vector0\ +\ v[2],}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keyword}{inline}\ CGAL::Aff\_transformation\_3<IK>\ plane\_to\_xy(IK::Point\_3\ O0,\ IK::Plane\_3\ plane)}
\DoxyCodeLine{00204\ \ \ \ \ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ X0\ =\ plane.base1();}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ Y0\ =\ plane.base2();}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ Z0\ =\ plane.orthogonal\_vector();}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ unitize(X0);}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ unitize(Y0);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ unitize(Z0);}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ transformation\ maps\ P0\ to\ P1,\ P0+X0\ to\ P1+X1,\ ...}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ to\ origin\ -\/>\ T0\ translates\ point\ P0\ to\ (0,0,0)}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ T0(CGAL::TRANSLATION,\ IK::Vector\_3(0\ -\/\ O0.x(),\ 0\ -\/\ O0.y(),\ 0\ -\/\ O0.z()));}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rotate\ -\/>}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ F0(}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ X0.x(),\ X0.y(),\ X0.z(),}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ Y0.x(),\ Y0.y(),\ Y0.z(),}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ Z0.x(),\ Z0.y(),\ Z0.z());}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ F0\ *\ T0;}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keyword}{inline}\ IK::Point\_3\ point\_at(\textcolor{keyword}{const}\ IK::Segment\_3\ \&l,\ \textcolor{keywordtype}{double}\ t)}
\DoxyCodeLine{00227\ \ \ \ \ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ s\ =\ 1.0\ -\/\ t;}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ IK::Point\_3(}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ (l[0].x()\ ==\ l[1].x())\ ?\ l[0].x()\ :\ s\ *\ l[0].x()\ +\ t\ *\ l[1].x(),}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ (l[0].y()\ ==\ l[1].y())\ ?\ l[0].y()\ :\ s\ *\ l[0].y()\ +\ t\ *\ l[1].y(),}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ (l[0].z()\ ==\ l[1].z())\ ?\ l[0].z()\ :\ s\ *\ l[0].z()\ +\ t\ *\ l[1].z());}
\DoxyCodeLine{00234\ \ \ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ closest\_point\_to(\textcolor{keyword}{const}\ IK::Point\_3\ \&point,\ \textcolor{keyword}{const}\ IK::Segment\_3\ \&s,\ \textcolor{keywordtype}{double}\ \&t)}
\DoxyCodeLine{00237\ \ \ \ \ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ rc\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ IK::Vector\_3\ D\ =\ s.to\_vector();}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ DoD\ =\ D.squared\_length();}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (DoD\ >\ 0.0)}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((point\ -\/\ s[0]).squared\_length()\ <=\ (point\ -\/\ s[1]).squared\_length())}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ ((point\ -\/\ s[0])\ *\ D)\ /\ DoD;}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 1.0\ +\ ((point\ -\/\ s[1])\ *\ D)\ /\ DoD;}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ rc\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ (GBA)\ Closest\ point\ to\ a\ degenerate\ line\ works\ as\ well}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ 0.0;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ rc\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rc;}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ line\_line\_intersection\_with\_properties(}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ IK::Segment\_3\ \&s0,\ IK::Segment\_3\ \&s1,}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ number\_of\_polyline\_segments0,\ \textcolor{keywordtype}{int}\ number\_of\_polyline\_segments1,\ \textcolor{keywordtype}{int}\ current\_polyline\_segment0,\ \textcolor{keywordtype}{int}\ current\_polyline\_segment1,}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ above\_closer\_to\_edge,}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ IK::Point\_3\ \&p0,\ IK::Point\_3\ \&p1,\ IK::Vector\_3\ \&v0,\ IK::Vector\_3\ \&v1,\ IK::Vector\_3\ \&normal,}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \&type0,\ \textcolor{keywordtype}{bool}\ \&type1,}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \&is\_parallel}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ )}
\DoxyCodeLine{00271\ \ \ \ \ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Unlike\ lines,\ segments\ do\ not\ extend\ beyond\ their\ start\ and\ end\ points.}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Segment\ vector}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ v0\ =\ s0.to\_vector();}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ v1\ =\ s1.to\_vector();}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ normal\ that\ can\ be\ parallel\ and\ thus\ not\ valid}}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ normal\ =\ CGAL::cross\_product(v0,\ v1);}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ is\_parallel\ =\ normal\ ==\ CGAL::NULL\_VECTOR\ ||\ (90.0\ -\/\ fabs(CGAL::approximate\_angle(v0,\ v1)\ -\/\ 90))\ <\ 1;}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ normal\ =\ is\_parallel\ ?\ IK::Plane\_3(s0[0],\ s0.to\_vector()).base1()\ :\ normal;}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ unitize(normal);}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ 2\ intersection\ points\ of\ intersecting\ segments\ are\ identical.}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[0],\ s1[0])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[0];}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[0];}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ s0[1]\ -\/\ s0[0];}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ s1[1]\ -\/\ s1[0];}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v0);}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v1);}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[0],\ s1[1])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[0];}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[0];}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ s0[1]\ -\/\ s0[0];}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ s1[0]\ -\/\ s1[1];}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v0);}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v1);}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[1],\ s1[0])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[1];}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[1];}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ s0[0]\ -\/\ s0[1];}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ s1[1]\ -\/\ s1[0];}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v0);}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v1);}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[1],\ s1[1])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[1];}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[1];}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ s0[0]\ -\/\ s0[1];}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ s1[0]\ -\/\ s1[1];}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v0);}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v1);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Collinear\ segments\ or\ //Parallel\ segments\ do\ not\ intersect.}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_parallel)}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l0\ =\ s0.supporting\_line();}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l1\ =\ s1.supporting\_line();}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ s0.to\_vector();}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ v0\ /\ CGAL::approximate\_sqrt(v0\ *\ v0);}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ s1.to\_vector();}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ v1\ /\ CGAL::approximate\_sqrt(v1\ *\ v1);}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<IK::FT,\ IK::FT>>\ points\_along\_lines;}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ create\_projection\ =\ [\&](\textcolor{keyword}{const}\ IK::Point\_3\ \&p)}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\ =\ l0.projection(p);}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ vec0(s0.source(),\ p0);}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::FT\ pos0\ =\ vec0\ *\ v0;}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\ =\ l1.projection(p);}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ vec1(s1.source(),\ p1);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::FT\ pos1\ =\ vec1\ *\ v1;}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ points\_along\_lines.emplace\_back(pos0,\ pos1);}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s0.source());}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s0.target());}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s1.source());}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s1.target());}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ std::sort(points\_along\_lines.begin(),\ points\_along\_lines.end(),}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&a,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&b)\ -\/>\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ a.first\ <\ b.first;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ seg0(s0.source()\ +\ points\_along\_lines[1].first\ *\ v0,}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s0.source()\ +\ points\_along\_lines[2].first\ *\ v0);}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ seg1(s1.source()\ +\ points\_along\_lines[1].second\ *\ v1,}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s1.source()\ +\ points\_along\_lines[2].second\ *\ v1);}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Not\ sure\ this\ is\ correct}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ CGAL::midpoint(seg0[0],\ seg0[1]);}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ CGAL::midpoint(seg1[0],\ seg1[1]);}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ CGAL::midpoint(p0,\ p1);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ l1.projection(p0);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ l0.projection(p0);}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ t0,\ t1;}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p0,\ s0,\ t0);}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p1,\ s1,\ t1);}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t0\ >\ 0.5)}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ *=\ -\/1;}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t1\ >\ 0.5)}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ *=\ -\/1;}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Skew\ segments\ have\ two\ different\ intersection\ points.}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Works\ only\ if\ segments\ are\ not\ co-\/linear}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v0);}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(v1);}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Plane\_3\ plane(s0[0],\ normal);}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ xform\ =\ plane\_to\_xy(s0[0],\ plane);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ xform\_Inv\ =\ xform.inverse();}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\_0\ =\ xform.transform(s0[0]);}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\_1\ =\ xform.transform(s0[1]);}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\_0\ =\ xform.transform(s1[0]);}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\_1\ =\ xform.transform(s1[1]);}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_2\ l0(IK::Point\_2(p0\_0.hx(),\ p0\_0.hy()),\ IK::Point\_2(p0\_1.hx(),\ p0\_1.hy()));}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_2\ l1(IK::Point\_2(p1\_0.hx(),\ p1\_0.hy()),\ IK::Point\_2(p1\_1.hx(),\ p1\_1.hy()));}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l1\_3d\ =\ s1.supporting\_line();}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ result\ =\ CGAL::intersection(l0,\ l1);}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ t0,\ t1;}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!result)}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{const}\ IK::Point\_2\ *p\ =\ boost::get<IK::Point\_2>(\&*result))}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ IK::Point\_3(p-\/>hx(),\ p-\/>hy(),\ 0);}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ xform\_Inv.transform(p0);}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p0,\ s0,\ t0);}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ outside0\ =\ t0\ >\ 1.0\ ||\ t0\ <\ 0.0;}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outside0)}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t0\ =\ std::max(0.0,\ std::min(t0,\ 1.0));}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ point\_at(s0,\ t0);}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ l1\_3d.projection(p0);\ \textcolor{comment}{//\ is\ it\ ok?}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p1,\ s1,\ t1);}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ outside1\ =\ t1\ >\ 1.0\ ||\ t1\ <\ 0.0;}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outside1)}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t1\ =\ std::max(0.0,\ std::min(t1,\ 1.0));}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ point\_at(s1,\ t1);}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Type\ and\ parameter}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bool\ reverse\_v0\ =\ t0\ >\ 0.5;}}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bool\ reverse\_v1\ =\ t1\ >\ 0.5;}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ remap\ to\ the\ whole\ polyline\ parameter}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ t0\ +=\ current\_polyline\_segment0;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ t1\ +=\ current\_polyline\_segment1;}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ t0\ =\ remap(t0,\ 0.0,\ number\_of\_polyline\_segments0\ *\ 1.0,\ 0.0,\ 1.0);}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ t1\ =\ remap(t1,\ 0.0,\ number\_of\_polyline\_segments1\ *\ 1.0,\ 0.0,\ 1.0);}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ how\_close\_to\_line\_end\_0\ =\ 2\ *\ std::abs(0.5\ -\/\ t0);}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ how\_close\_to\_line\_end\_1\ =\ 2\ *\ std::abs(0.5\ -\/\ t1);}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ decide\ what\ type\ it\ is}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL\_Debug(diff0);}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL\_Debug(diff1);}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cross}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (above\_closer\_to\_edge\ <\ 0.0)}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 1;}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 1;}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ side-\/to-\/end\ sorted}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (above\_closer\_to\_edge\ >\ 1.0)}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ t0\ <\ t1\ ?\ 0\ :\ 1;}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ t0\ <\ t1\ ?\ 1\ :\ 0;}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ according\ to\ parameter}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ how\_close\_to\_line\_end\_0\ >\ above\_closer\_to\_edge\ ?\ 0\ :\ 1;}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ how\_close\_to\_line\_end\_1\ >\ above\_closer\_to\_edge\ ?\ 0\ :\ 1;}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sort\ types}}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (how\_close\_to\_line\_end\_0\ >\ how\_close\_to\_line\_end\_1\ \&\&\ type0\ ==\ 0\ \&\&\ type1\ ==\ 0)}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 0;}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 1;}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (how\_close\_to\_line\_end\_0\ <\ how\_close\_to\_line\_end\_1\ \&\&\ type0\ ==\ 0\ \&\&\ type1\ ==\ 0)}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type0\ =\ 1;}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type1\ =\ 0;}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cross\ or\ female\ edge\ direction\ does\ not\ matter?}}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ orient\ male\ vectors,\ if\ t-\/parameter\ >\ 0.5,\ flip\ segment\ vector\ to\ orient\ the\ joint\ towards\ the\ longer\ side}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//<-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/.\ 0.25\ no-\/flip\ \ \ \ \ \ \ \ \ \ .-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*-\/-\/-\/-\/>\ 0.75\ flip}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t0\ >\ 0.5\ \&\&\ type0\ ==\ 0)}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ *=\ -\/1;}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t1\ >\ 0.5\ \&\&\ type1\ ==\ 0)}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ *=\ -\/1;}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00514\ \ \ \ \ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ line\_line\_intersection(IK::Segment\_3\ \&s0,\ IK::Segment\_3\ \&s1,\ \textcolor{keywordtype}{bool}\ finite,\ IK::Point\_3\ \&p0,\ IK::Point\_3\ \&p1)}
\DoxyCodeLine{00517\ \ \ \ \ \{}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ IK::Vector\_3\ v0\ =\ s0.to\_vector();}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ IK::Vector\_3\ v1\ =\ s1.to\_vector();}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ IK::Vector\_3\ normal\ =\ CGAL::cross\_product(v0,\ v1);}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}line\_line\_intersection\ \(\backslash\)n"{}});}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ angle\ =\ 90.0\ -\/\ fabs(CGAL::approximate\_angle(v0,\ v1)\ -\/\ 90);}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ 2\ intersection\ points\ of\ intersecting\ segments\ are\ identical.}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[0],\ s1[0])\ <\ wood\_globals::DISTANCE\ ||\ CGAL::squared\_distance(s0[0],\ s1[1])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[0];}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[0];}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CGAL::squared\_distance(s0[1],\ s1[0])\ <\ wood\_globals::DISTANCE\ ||\ CGAL::squared\_distance(s0[1],\ s1[1])\ <\ wood\_globals::DISTANCE)}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ s0[1];}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ s0[1];}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Collinear\ segments\ or\ //Parallel\ segments\ do\ not\ intersect.}}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (normal\ ==\ CGAL::NULL\_VECTOR\ ||\ angle\ <\ 1)}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l0\ =\ s0.supporting\_line();}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l1\ =\ s1.supporting\_line();}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ v0\ =\ s0.to\_vector();}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ v0\ /\ CGAL::approximate\_sqrt(v0\ *\ v0);}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ v1\ =\ s1.to\_vector();}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ v1\ /\ CGAL::approximate\_sqrt(v1\ *\ v1);}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::pair<IK::FT,\ IK::FT>>\ points\_along\_lines;}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ create\_projection\ =\ [\&](\textcolor{keyword}{const}\ IK::Point\_3\ \&p)}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\ =\ l0.projection(p);}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ vec0(s0.source(),\ p0);}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::FT\ pos0\ =\ vec0\ *\ v0;}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\ =\ l1.projection(p);}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ vec1(s1.source(),\ p1);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::FT\ pos1\ =\ vec1\ *\ v1;}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ points\_along\_lines.emplace\_back(pos0,\ pos1);}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s0.source());}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s0.target());}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s1.source());}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ create\_projection(s1.target());}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ std::sort(points\_along\_lines.begin(),\ points\_along\_lines.end(),}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ [](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&a,\ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \&b)\ -\/>\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ return\ a.first\ <\ b.first;}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ seg0(s0.source()\ +\ points\_along\_lines[1].first\ *\ v0,}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s0.source()\ +\ points\_along\_lines[2].first\ *\ v0);}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ seg1(s1.source()\ +\ points\_along\_lines[1].second\ *\ v1,}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s1.source()\ +\ points\_along\_lines[2].second\ *\ v1);}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Not\ sure\ this\ is\ correct}}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ CGAL::midpoint(seg0[0],\ seg0[1]);}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ CGAL::midpoint(seg1[0],\ seg1[1]);}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ CGAL::midpoint(p0,\ p1);}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ l1.projection(p0);}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ l0.projection(p0);}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \{\ \textcolor{comment}{//\ Skew\ segments\ have\ two\ different\ intersection\ points.}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Co-\/linear\ -\/\ check\ ends}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Works\ only\ if\ segments\ are\ not\ co-\/linear}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Plane\_3\ plane(s0[0],\ normal);}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ xform\ =\ plane\_to\_xy(s0[0],\ plane);}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ CGAL::Aff\_transformation\_3<IK>\ xform\_Inv\ =\ xform.inverse();}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\_0\ =\ xform.transform(s0[0]);}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0\_1\ =\ xform.transform(s0[1]);}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\_0\ =\ xform.transform(s1[0]);}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1\_1\ =\ xform.transform(s1[1]);}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_2\ l0(IK::Point\_2(p0\_0.hx(),\ p0\_0.hy()),\ IK::Point\_2(p0\_1.hx(),\ p0\_1.hy()));}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_2\ l1(IK::Point\_2(p1\_0.hx(),\ p1\_0.hy()),\ IK::Point\_2(p1\_1.hx(),\ p1\_1.hy()));}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Line\_3\ l1\_3d\ =\ s1.supporting\_line();}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ result\ =\ CGAL::intersection(l0,\ l1);}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result)}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{const}\ IK::Point\_2\ *p\ =\ boost::get<IK::Point\_2>(\&*result))}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ IK::Point\_3(p-\/>hx(),\ p-\/>hy(),\ 0);}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ xform\_Inv.transform(p0);}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (finite)}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ t0,\ t1;}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p0,\ s0,\ t0);}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ outside0\ =\ t0\ >\ 1.0\ ||\ t0\ <\ 0.0;}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outside0)}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t0\ =\ std::max(0.0,\ std::min(t0,\ 1.0));}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p0\ =\ point\_at(s0,\ t0);}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ l1\_3d.projection(p0);\ \textcolor{comment}{//\ is\ it\ ok?}}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ closest\_point\_to(p1,\ s1,\ t1);}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ outside1\ =\ t1\ >\ 1.0\ ||\ t1\ <\ 0.0;}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outside1)}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t1\ =\ std::max(0.0,\ std::min(t1,\ 1.0));}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ point\_at(s1,\ t1);}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p1\ =\ l1\_3d.projection(p0);\ \textcolor{comment}{//\ is\ it\ ok?}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00657\ \ \ \ \ \}}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ \ \ \textcolor{comment}{//\ https://github.com/CGAL/cgal/issues/6089}}
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{comment}{//\ https://gist.github.com/sloriot/0943fec878401e04930b7bcbd73baf91}}
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ intersecting\_sequences\_of\_dD\_iso\_oriented\_boxes(std::vector<CGAL\_Polyline>\ \&polylines,\ std::vector<std::vector<double>>\ \&polylines\_segment\_radii,\ \textcolor{keywordtype}{double}\ \&min\_distance,}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::array<int,\ 4>>\ \&polyline0\_id\_segment0\_id\_polyline1\_id\_segment1\_id,}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<std::array<IK::Point\_3,\ 2>>\ \&point\_pairs}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ )}
\DoxyCodeLine{00666\ \ \ \ \ \{}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL\_Debug(polylines.size());}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Segment\ callback}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ segment\ =\ [\&polylines](std::size\_t\ pid,\ std::size\_t\ sid)}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ IK::Segment\_3(polylines[pid][sid],\ polylines[pid][sid\ +\ 1]);}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ return\ EK::Segment\_3(}}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ EK::Point\_3(polylines[pid][sid][0],\ polylines[pid][sid][1],\ polylines[pid][sid][2]),}}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ EK::Point\_3(polylines[pid\ +\ 1][sid][0],\ polylines[pid][sid\ +\ 1][1],\ polylines[pid][sid\ +\ 1][2])}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//);}}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ segment\_inflated\ =\ [\&polylines,\ \&polylines\_segment\_radii](std::size\_t\ pid,\ std::size\_t\ sid)}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ segment(polylines[pid][sid],\ polylines[pid][sid\ +\ 1]);}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IK::Vector\_3\ v0\ =\ segment.to\_vector();}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ segment\ =\ IK::Segment\_3(segment[0]\ -\/\ v0*1,\ segment[1]\ +\ v0*1);}}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius\ =\ polylines\_segment\_radii[pid][sid];}
\DoxyCodeLine{00690\ }
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ zaxis\ =\ segment.to\_vector();}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Plane\_3\ plane(segment[0],\ zaxis);}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ x\_axis\ =\ plane.base1();}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Vector\_3\ y\_axis\ =\ plane.base2();\ \textcolor{comment}{//\ CGAL::cross\_product(x\_axis,\ zaxis);}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(x\_axis);}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ unitize(y\_axis);}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ x\_axis\ =\ cgal\_vector\_util::Unit(x\_axis);}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ y\_axis\ =\ cgal\_vector\_util::Unit(y\_axis);}}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ x\_axis\ *=\ radius;}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ y\_axis\ *=\ radius;}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ std::array<IK::Point\_3,\ 8>\ pts\ =\ \{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[0]\ +\ x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[0]\ -\/\ x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[0]\ -\/\ x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[0]\ +\ x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[1]\ +\ x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[1]\ -\/\ x\_axis\ +\ y\_axis,}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[1]\ -\/\ x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment[1]\ +\ x\_axis\ -\/\ y\_axis,}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ CGAL::Bbox\_3\ box\ =\ CGAL::bbox\_3(pts.begin(),\ pts.end(),\ IK());}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ segment\_inflated(IK::Point\_3(box.xmin(),\ box.ymin(),\ box.zmin()),\ IK::Point\_3(box.xmax(),\ box.ymax(),\ box.zmax()));}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL\_Debug(box.xmin(),\ box.ymin(),\ box.zmin());}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CGAL\_Debug(box.xmax(),\ box.ymax(),\ box.zmax());}}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ segment\_inflated;}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ corresponding\ vector\ of\ bounding\ boxes}}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ std::vector<Box>\ boxes;}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ pid\ =\ 0;\ pid\ <\ polylines.size();\ ++pid)}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (std::size\_t\ sid\ =\ 0;\ sid\ <\ polylines[pid].size()\ -\/\ 1;\ ++sid)}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ boxes.push\_back(Box(segment\_inflated(pid,\ sid).bbox(),\ std::make\_pair(pid,\ sid)));}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\_interesect\ call\_back}}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ std::map<uint64\_t,\ std::tuple<double,\ int,\ int,\ int,\ int>>\ pair\_collisions;}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ std::vector<std::tuple<double,\ int,\ int,\ int,\ int>>\ pair\_collisionslist;}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ callback\ =\ [\&segment,\ \&min\_distance,\ \&pair\_collisions,\ \&pair\_collisionslist](\textcolor{keyword}{const}\ Box\ \&b1,\ \textcolor{keyword}{const}\ Box\ \&b2)}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (b1.info().first\ !=\ b2.info().first)}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ s0\ =\ segment(b1.info().first,\ b1.info().second);}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ s1\ =\ segment(b2.info().first,\ b2.info().second);}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IK::Vector\_3\ v0\ =\ s0.to\_vector();}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ IK::Vector\_3\ v1\ =\ s1.to\_vector();}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ s0\ =\ IK::Segment\_3(s0[0]\ -\/\ v0,\ s0[1]\ +\ v0);}}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ s1\ =\ IK::Segment\_3(s1[0]\ -\/\ v1,\ s1[1]\ +\ v1);}}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ distance\ =\ CGAL::squared\_distance(s0,\ s1);}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (distance\ <\ min\_distance\ *\ min\_distance)}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ size\_t\ first\_0\ =\ 0,\ first\_1\ =\ 0;}}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ flipped\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ id;}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (b2.info().first\ >\ b1.info().first)}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flipped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ (uint64\_t)b2.info().first\ <<\ 32\ |\ b1.info().first;}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ flipped\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{id}\ =\ (uint64\_t)b1.info().first\ <<\ 32\ |\ b2.info().first;}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00764\ }
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::tuple<double,\ int,\ int,\ int,\ int>\ dist\_and\_segment\_ids\ =\ flipped\ ?\ std::make\_tuple((\textcolor{keywordtype}{double})distance,\ (\textcolor{keywordtype}{int})b1.info().first,\ (\textcolor{keywordtype}{int})b1.info().second,\ (\textcolor{keywordtype}{int})b2.info().first,\ (\textcolor{keywordtype}{int})b2.info().second)\ :\ std::make\_tuple((double)distance,\ (int)b2.info().first,\ (int)b2.info().second,\ (int)b1.info().first,\ (int)b1.info().second);}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ elements\ to\ std::map}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pair\_collisions.find(\textcolor{keywordtype}{id})\ ==\ pair\_collisions.end())}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ found}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pair\_collisions.insert(std::make\_pair((uint64\_t)\textcolor{keywordtype}{id},\ dist\_and\_segment\_ids));}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pair\_collisionslist.emplace\_back(dist\_and\_segment\_ids);}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (distance\ <\ std::get<0>(pair\_collisions[\textcolor{keywordtype}{id}]))}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pair\_collisions.insert(std::make\_pair((uint64\_t)\textcolor{keywordtype}{id},\ dist\_and\_segment\_ids));}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ found\ and\ distance\ is\ smaller\ that\ before\ found}}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pair\_collisions[id]\ =\ dist\_and\_segment\_ids;}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pair\_collisionslist.emplace\_back(dist\_and\_segment\_ids);}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ check\ if\ lines\ closer\ than\ the\ given\ distance}}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \textcolor{comment}{//\ check\ if\ boxes\ do\ not\ belong\ to\ the\ same\ group\ b.info().first}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ self\ intersection}}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ CGAL::box\_self\_intersection\_d(boxes.begin(),\ boxes.end(),\ callback);}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Iterate\ the\ result,\ get\ insertion\ points\ and\ parameter\ on\ the\ lines}}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ polyline0\_id\_segment0\_id\_polyline1\_id\_segment1\_id.reserve(pair\_collisions.size()\ *\ 4);}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ point\_pairs.reserve(point\_pairs.size()\ *\ 2);}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&x\ :\ pair\_collisions)}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \&v\ =\ x.second;}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ s0\ =\ segment(std::get<1>(v),\ std::get<2>(v));}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Segment\_3\ s1\ =\ segment(std::get<3>(v),\ std::get<4>(v));}
\DoxyCodeLine{00802\ }
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p0;}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ IK::Point\_3\ p1;}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ r\ =\ line\_line\_intersection(s0,\ s1,\ \textcolor{keyword}{true},\ p0,\ p1);}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!r)}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ point\_pairs.emplace\_back(std::array<IK::Point\_3,\ 2>\{p0,\ p1\});}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00810\ \ \ \ \ \}}
\DoxyCodeLine{00811\ \}}

\end{DoxyCode}
